{{ define "main" }}
<div class="container">
  <div class="row">
    <div class="col-12">
      <h1>{{ .Title }}</h1>
      {{ if .Description }}
      <div class="gallery-description">
        <p>{{ .Description }}</p>
      </div>
      {{ end }}
      
      {{ partial "gallery.html" . }}
    </div>
  </div>
</div>

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/photoswipe@5.3.4/dist/photoswipe.css" />
<script type="module">
  import PhotoSwipeLightbox from 'https://cdn.jsdelivr.net/npm/photoswipe@5.3.4/dist/photoswipe-lightbox.esm.js';
  import PhotoSwipe from 'https://cdn.jsdelivr.net/npm/photoswipe@5.3.4/dist/photoswipe.esm.js';

  const lightbox = new PhotoSwipeLightbox({
    gallery: '#gallery',
    children: 'a.gallery-item',
    pswpModule: PhotoSwipe,
    showHideAnimationType: 'fade',
    bgOpacity: 0.9
  });

  lightbox.on('loadComplete', (e) => {
    const { content } = e;
    const item = content.data;
    if (item.pswpWidth && item.pswpHeight) {
      content.width = item.pswpWidth;
      content.height = item.pswpHeight;
    }
  });

  lightbox.on('itemData', (e) => {
    const linkEl = e.item.element;
    if (linkEl) {
      e.itemData.src = linkEl.getAttribute('data-pswp-src') || linkEl.href;
      const width = parseInt(linkEl.getAttribute('data-pswp-width'));
      const height = parseInt(linkEl.getAttribute('data-pswp-height'));
      if (width && height) {
        e.itemData.width = width;
        e.itemData.height = height;
      }
      e.itemData.title = linkEl.getAttribute('title') || '';
    }
  });

  lightbox.init();
</script>

<script src="https://cdn.jsdelivr.net/npm/lazysizes@5.3.2/lazysizes.min.js" async></script>

<style>
.gallery {
  margin-top: 2rem;
}

#gallery {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
  gap: 1rem;
  visibility: visible !important;
  height: auto !important;
  overflow: visible !important;
}

.gallery-item {
  display: block;
  position: relative;
  overflow: hidden;
  border-radius: 8px;
  cursor: pointer;
  text-decoration: none;
  transition: transform 0.2s ease, box-shadow 0.2s ease;
}

.gallery-item:hover {
  transform: translateY(-4px);
  box-shadow: 0 8px 16px rgba(0, 0, 0, 0.15);
}

.gallery-item figure {
  margin: 0;
  padding: 0;
  width: 100%;
  height: 100%;
  position: relative;
  overflow: hidden;
}

.gallery-item img {
  width: 100%;
  height: 100%;
  object-fit: contain;
  display: block;
  transition: transform 0.3s ease;
}

.gallery-item:hover img {
  transform: scale(1.05);
}

.gallery-description {
  margin: 1rem 0 2rem 0;
  font-size: 1.1rem;
  line-height: 1.6;
  color: #666;
}

@media (max-width: 768px) {
  #gallery {
    grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
    gap: 0.75rem;
  }
}

@media (max-width: 480px) {
  #gallery {
    grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
    gap: 0.5rem;
  }
}
</style>
{{ end }}

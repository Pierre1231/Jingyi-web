{{- $album := .Get "images" | default "photography" -}}
{{- $photoFiles := slice "1.JPG" "2.jpg" "3.jpg" "4.jpg" "5.jpg" "6.jpg" "7.jpg" "8.jpg" "9.jpg" -}}

<div class="photo-wall-masonry-container">
  <div class="photo-wall-masonry-grid" id="masonryGrid">
    {{- range $index, $imgName := $photoFiles -}}
      {{- $imgPath := printf "/media/albums/%s/%s" $album $imgName -}}
      <div class="masonry-item" data-index="{{ $index }}">
        <a href="{{ $imgPath }}" class="glightbox" data-glightbox="title: Photography; description: " data-index="{{ $index }}">
          <img src="{{ $imgPath }}" alt="Photography" loading="lazy" data-src="{{ $imgPath }}" />
        </a>
      </div>
    {{- end -}}
  </div>
</div>

<script>
(function() {
  'use strict';
  
  // Masonry layout implementation
  function initMasonry() {
    const grid = document.getElementById('masonryGrid');
    if (!grid) return;
    
    const items = grid.querySelectorAll('.masonry-item');
    if (items.length === 0) return;
    
    // Reset grid for recalculation
    items.forEach(item => {
      item.style.height = 'auto';
    });
    
    // Calculate optimal layout based on screen size
    const screenWidth = window.innerWidth;
    let columns = 1;
    
    if (screenWidth >= 1400) {
      columns = 4;
    } else if (screenWidth >= 1024) {
      columns = 3;
    } else if (screenWidth >= 768) {
      columns = 2;
    } else {
      columns = 1;
    }
    
    // Set grid columns
    grid.style.gridTemplateColumns = `repeat(${columns}, 1fr)`;
    
    // Load images and maintain aspect ratio
    items.forEach((item, index) => {
      const img = item.querySelector('img');
      if (img && !img.complete) {
        img.onload = function() {
          item.style.opacity = '1';
        };
      } else {
        item.style.opacity = '1';
      }
    });
  }
  
  // Throttle resize handler
  let resizeTimer;
  function handleResize() {
    clearTimeout(resizeTimer);
    resizeTimer = setTimeout(initMasonry, 250);
  }
  
  // Initialize on load and resize
  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', initMasonry);
  } else {
    initMasonry();
  }
  
  window.addEventListener('resize', handleResize);
  
  // Reinitialize when images load
  window.addEventListener('load', function() {
    setTimeout(initMasonry, 100);
  });
})();
</script>

<style>
.photo-wall-masonry-container {
  max-width: 1400px;
  margin: 0 auto;
  padding: 0 1rem 4rem;
}

.photo-wall-masonry-grid {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
  gap: 1rem;
  align-items: start;
}

@media (min-width: 768px) {
  .photo-wall-masonry-grid {
    grid-template-columns: repeat(2, 1fr);
    gap: 1.25rem;
  }
}

@media (min-width: 1024px) {
  .photo-wall-masonry-grid {
    grid-template-columns: repeat(3, 1fr);
    gap: 1.5rem;
  }
}

@media (min-width: 1400px) {
  .photo-wall-masonry-grid {
    grid-template-columns: repeat(4, 1fr);
    gap: 1.75rem;
  }
}

.masonry-item {
  position: relative;
  overflow: hidden;
  border-radius: 2px;
  background: #fff;
  cursor: pointer;
  transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1),
              box-shadow 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  opacity: 0;
  animation: masonryFadeIn 0.6s ease-out forwards;
  break-inside: avoid;
}

@keyframes masonryFadeIn {
  from {
    opacity: 0;
    transform: translateY(20px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

.masonry-item:hover {
  transform: translateY(-4px);
  box-shadow: 0 12px 28px rgba(0, 0, 0, 0.15);
  z-index: 10;
}

.masonry-item a {
  display: block;
  width: 100%;
  text-decoration: none;
  color: transparent;
}

.masonry-item img {
  width: 100%;
  height: auto;
  display: block;
  object-fit: contain;
  transition: transform 0.5s cubic-bezier(0.4, 0, 0.2, 1);
  background: #f5f5f5;
}

.masonry-item:hover img {
  transform: scale(1.03);
}

@media (max-width: 767px) {
  .photo-wall-masonry-grid {
    grid-template-columns: 1fr;
    gap: 1rem;
  }
  
  .photo-wall-masonry-container {
    padding: 0 0.5rem 3rem;
  }
}
</style>

